<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>Захист від спаму без капчі</title>
<meta content="Захист від спаму без капчі" itemprop="name" property="og:title">
<meta content="Мій досвід боротьби зі спамом у коментарях. Я розкажу як можна захиститись та обійтись без капчі" itemprop="description" name="description" property="og:description">
<meta content="http://lukom.org/blog/spam-defence" property="og:url">
<meta content="http://lukom.org/system/blog-images/spam.jpg" property="og:image">
<meta content="article" property="og:type">
<meta content="100001353345404" property="fb:admins">
<meta content="143733555820368" property="fb:app_id">
<link href="/rss.xml" rel="alternate" title="Найсвіжіші новини на Lukom.Org" type="application/rss+xml">
<link href="/favicon.ico" rel="shortcut icon">
<link href="http://lukom.org/blog/spam-defence" rel="canonical">
<link rel="stylesheet" media="all" href="/assets/application-2a591d5290045599514662b1c39ab8768fd1c67823af39790508e54e5bb81240.css" />


<script src="/assets/application-eded4902b2aa14be28bef0ed26fb2334e7f2fd1cb344acb9fffcb01b68a4bc14.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-19834031-1', 'lukom.org');
  ga('send', 'pageview');
</script>


</head>
<body>
<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=143733555820368";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>
<div class="header-toolbar">
<div class="page-wrap">
<ul>
<li><a href="/">Головна</a></li>
<li><a href="/pages/author">Автор</a></li>
</ul>
</div>
</div>
<div class="header">
<div class="page-wrap">
<div class="logo">
<div class="logo-text">Вперед і вгору!</div>
<div class="logo-subtext">блог Лукома</div>
</div>
<div class="about-author">
<div class="author-speak">
Привіт, мене звати Лев Лукомський
<br/> я займаюсь розробкою веб-сайтів та ігор
<br/> ..і записую в блог все що взбреде в голову :)
<a href="/pages/author">Автор</a>
</div>
<div class="follow-links">
<a class="rss-big-link" target="_blank" href="/rss.xml">RSS</a>
</div>
<div class="contacts-links">
<a title="Джмейл" class="gmail ico" href="mailto:lllukom@gmail.com">Gmail</a>
<a title="Цукердрук" class="facebook ico" target="_blank" href="https://www.facebook.com/llukomsky">Facebook</a>
</div>
</div>
</div>
</div>
<div class="main-menu">
<div class="page-wrap">
<ul>
<li><a href="/category/tsikavynky">Цікавинки (12)</a></li>
<li><a href="/category/veseloshchi">Веселощі (14)</a></li>
<li><a href="/category/rozrobka">Розробка (23)</a></li>
<li><a href="/category/rizne">Різне (55)</a></li>
<li>
<a href="/category/novyny-saitu">Новини сайту</a>
</li>
</ul>
</div>
</div>

<div class="torso">
<div class="page-wrap">
<div class="page-content">
<div class="flash-messages">
</div>

<div class="box main-box post rozrobka">
<h1 class="box-title">Захист від спаму без капчі</h1>
<div class="box-content">
<div class="post-meta">
<span class="link category-link">
<a href="/category/rozrobka">Розробка</a>
</span>
<span class="link tag-link">Захист, Спам, JavaScript, Дослідження, Досвід, Програмування</span>
<span class="link date-link">2010.12.26</span>
<span class="link edited-link">Відредаговано: 2016.05.15</span>
</div>
<div class="post-content"><div class="box-images"><img alt="" src="/system/blog-images/spam.jpg" style="height:167px; width:169px" /></div>

<p>Коли я місяць тому переробив блог, я поставив простеньку форму для додавання коментарів.. І що б ви думали? Ну звичайно що через цю форму <strong>поліз злісний спам</strong>! Так, є така проблема &mdash; Спам, і щоб її побороти можна поставити капчу. Але капча це додатковий напряг для користувача, тому я вирішив будь-що обійтись без неї, і ставити капчу лише при крайній необхідності.</p>

<p>Отож я подумав і зробив <strong>4 приховані пастки для спам-робота</strong>:</p>

<ol>
	<li><strong>Приховане поле, яке має бути пустим</strong>. Дурний робот може подумати що це поле потрібно заповнити і заповнить його</li>
	<li><strong>Поле, в яке javascript`ом вписується певне значення</strong>. Можливо робот не виконує javascript`ів і відповідно він не заповнить це поле</li>
	<li><strong>Поле з підписом, згенерованим на основі часу</strong>. Тут я припустив, що боти можуть діяти наступним чином: бот знаходить форму на сайті, аналізує її і додає до своєї бази форм, а потім відсилає цю форму N раз на день. Якщо так, тоді він проіндексує цю форму з підписом, але підпис діє лише день, тому бот зможе насолоджуватись відсиланням спаму тільки доки не вийде термін придатності підпису, тобто 1 день. Але тут є небезпека нашкодити звичайному користувачу, який відкриє допис, а коментар вирішить написати через день..</li>
	<li><strong>Провірка на українські букви</strong>. Так як мій блог є українським - то я провіряю чи є хоча б 1 українська буква, і якщо нема - значить це спам. Це відсікає значну частину англомовного спаму.</li>
</ol>

<p>Отож я <strong>зробив вищеописані пастки і прикрутив статистику</strong> наскільки часто об які пастки спотикаються спам-боти. І ось що вийшло:</p>

<div class="box-images"><img alt="1 Пусте поле, 2 JavaScript, 3 Підпис, 4 Українська" src="/system/blog-images/spam-statistics-1.png" style="height:328px; width:475px" /></div>

<p>Статистика зібрана за місяць, а пастки розставлені не послідовно, а паралельно, тобто бот міг потрапити в декілька пасток одночасно. Нажаль не записав статистики скільки взагалі було спроб додати коментар.. Але мені здається, що це було 864 разів.</p>

<p>А тепер спробую проаналізувати ці результати.</p>

<ol>
	<li><strong>Захист на пусте поле виявився ефективним</strong>, але як виявилось в більшості це було не через те, що боти заповнювали це поле, навпаки, в POST-запиті вони навіть не включали цього поля. А правильна поведінка браузерів - відсилати пустий рядок.<br />
	Дуже дивно чому боти без проблем заповнювали поля <em>author</em>, <em>email</em> та <em>content</em>, але не заповнювали поля <em>your_site</em> (це якраз і було це &laquo;фейкове&raquo; приховане поле)... Можливо вони орієнтуються по назві полей? Тоді є сенс перейменувати фейкове поле на <em>email</em>, а всі решта полей на <em>field1</em>, <em>field2</em>, ... Тоді мабуть боти розгубляться і не будуть знати як заповнювати форму.<br />
	Але все ж деякі боти відправляли пустий рядок, або навіть коректно (або не дуже коректно) заповнювали це поле, так що не всі боти такі дурні.</li>
	<li><strong>Захист javascript`ом виявився панацеєю від усіх бід!</strong> Його ще досі не пройшов жоден бот на моєму сайті.</li>
	<li><strong>Захист підписом зовсім себе не виправдав.</strong> Виявилось, що кожен раз коли бот хоче відіслати спам, він перед тим заходить на сторінку з формою і ще раз аналізує форму. А цифра 214 означає, що деякі боти подумали що туди треба текст вставляти і перетирали підпис своїми значеннями.</li>
	<li><strong>Захист українською показав скільки було кириличного спаму.</strong> А його є ~38%.</li>
</ol>

<p><strong>Отож виявилось, що для захисту від ботів достатньо лише захисту javascript`ом.</strong> Зробити його дуже просто:</p>

<ol>
	<li>робимо у формі пусте приховане поле, наприклад так: &lt;input type=&quot;hidden&quot; name=&quot;signature&quot; id=&quot;signature&quot; /&gt;</li>
	<li>після цього ставим такий скрипт: document.getElementById(&#39;signature&#39;).value = &#39;123&#39;</li>
	<li>На сервері перевіряємо чи прийшло нам значення signature=123</li>
</ol>

<p>І па-па спам боти :)</p>
</div>
<div class="social-buttons">
<div class="fb-like" data-layout="button_count" data-send="false" data-width="120"></div>
</div>

<div id="related_posts">
<div class="h2">Читайте також</div>
<ul>
<li><a href="/blog/css3-vzhe-siohodni">CSS3 вже сьогодні</a></li>
<li><a href="/blog/spdy-na-saiti">Поставив SPDY на сайт</a></li>
<li><a href="/blog/jquery-rulezzz">jQuery кермує!</a></li>
<li><a href="/blog/msvitu">Ділюся досвідом після розробки msvitu.com</a></li>
<li><a href="/blog/how-to-download-books">Як завантажувати книжки з нету</a></li>
</ul>
</div>
<div id="comments">
<div class="comments" id="comments_entries">
<div class="h2">Коментарі (<span>5</span>)</div>
<div class="comment" id="comment_1413">
<div class="comment-meta">
<div class="avatar"><img alt="" src="https://secure.gravatar.com/avatar/5abd49062ba19f836140d82ce67d51bf.jpg?size=32&amp;default=wavatar&amp;rating=g" width="32" height="32" /></div>
<div class="author">Toss</div>
<div class="date">2010.12.26</div>
<div class="browser">
<img alt="chrome" title="chrome" src="/assets/icons/browsers/chrome-599273fb6c3c118598ed689b6289c08fe6e7aa15eba9655b1184f89805f34668.png" width="16" height="16" />
</div>
</div>
<div class="comment-content">Тебе багато спамлять. В мене взагалі ніякої капчі чи перевірки нема і ще спаму не було.</div>
</div>

<div class="comment" id="comment_1414">
<div class="comment-meta">
<div class="avatar"><img alt="" src="https://secure.gravatar.com/avatar/09196d27fdbce0be01814fae9ed12bc4.jpg?size=32&amp;default=wavatar&amp;rating=g" width="32" height="32" /></div>
<div class="author">mace</div>
<div class="date">2010.12.26</div>
<div class="browser">
<img alt="firefox" title="firefox" src="/assets/icons/browsers/firefox-a656a35645e76eeb7a4602c8b353f910266a5825baab2bb92683d43f9cc2598a.png" width="16" height="16" />
</div>
</div>
<div class="comment-content"><i>А правильна поведінка браузерів - відсилати пустий рядок.</i><br />Це прописано в якомусь стандарті? Тестив на всіх популярних браузерах? Я б краще на це не зав'язувався, бо є ризик натрапити на виключення з цього правила. Думаю з точки зору HTTP пусте поле еквівалентне його відсутності і цим можуть користуватись якісь проксі, стискалки трафіку і тому подібні штуки.<br /><b><strong></strong></b>Захист кирилицею - це, вибачте, фашизм. От полечу я в штати, зайду з їх компа без кирилиці і спробую щось написати транслітом. І що? Треба хоча б чесно попереджати про це і давати віртуальну клавіатуру для обділених кирилицею.<br />П.С. ІМХО джаваскріпта має вистачати з головою.</div>
</div>

<div class="comment" id="comment_1415">
<div class="comment-meta">
<div class="avatar"><img alt="" src="https://secure.gravatar.com/avatar/b8f0151689d924b68dfee734ffab20f0.jpg?size=32&amp;default=wavatar&amp;rating=g" width="32" height="32" /></div>
<div class="author">Lukom</div>
<div class="date">2010.12.26</div>
<div class="browser">
<img alt="firefox" title="firefox" src="/assets/icons/browsers/firefox-a656a35645e76eeb7a4602c8b353f910266a5825baab2bb92683d43f9cc2598a.png" width="16" height="16" />
</div>
</div>
<div class="comment-content"><span style="font-weight: bold;">2 toss:</span> мабуть це тому що в тебе двигунець blogger<br><br><span style="font-weight: bold;">2 mace:</span> звичайно що пробував, усі браузери відсилають пустий рядок. я деколи переглядаю логи і дивлюсь випадки коли не змогли додати коментар - поки що через Це не було проблем.<br>Щодо трансліту, то я його не дуже "переварюю", але згідний, про це треба попереджати.<br>Тепер я не тільки "думаю" а й "емпірично визначив" що джаваскріпта з головою вистачає :) так що найближчим часом зменшу кількість перевірок до цієї одної. А ще перероблю форму на ajax.</div>
</div>

<div class="comment" id="comment_1417">
<div class="comment-meta">
<div class="avatar"><img alt="" src="https://secure.gravatar.com/avatar/b8f0151689d924b68dfee734ffab20f0.jpg?size=32&amp;default=wavatar&amp;rating=g" width="32" height="32" /></div>
<div class="author">Lukom</div>
<div class="date">2010.12.28</div>
<div class="browser">
<img alt="firefox" title="firefox" src="/assets/icons/browsers/firefox-a656a35645e76eeb7a4602c8b353f910266a5825baab2bb92683d43f9cc2598a.png" width="16" height="16" />
</div>
</div>
<div class="comment-content">Вже переробив, і мої догадки справдились - більшість ботів не заповнюють полей з назвами field1, field2, ... лише заповнюють те що в textarea. Але навіть якщо заповнюють, то вони ж не знають що у field2 має бути email! Дурні боти :)<br>А ще я тепер переробив коменти на AJAX і перевіряю чи запит прийшов через AJAX чи через тупий POST, тепер всі боти на цьому валяться.</div>
</div>

<div class="comment" id="comment_1420">
<div class="comment-meta">
<div class="avatar"><img alt="" src="https://secure.gravatar.com/avatar/a1abf597380fc4c6126646d257bb17a8.jpg?size=32&amp;default=wavatar&amp;rating=g" width="32" height="32" /></div>
<div class="author">StepEx</div>
<div class="date">2011.01.16</div>
<div class="browser">
<img alt="firefox" title="firefox" src="/assets/icons/browsers/firefox-a656a35645e76eeb7a4602c8b353f910266a5825baab2bb92683d43f9cc2598a.png" width="16" height="16" />
</div>
</div>
<div class="comment-content">є гарний онлайн сервіс для відсіювання спаму - Akismet</div>
</div>

</div>
</div>

<div class="fb-comments" data-href="http://lukom.org/blog/spam-defence" data-num-posts="5" data-width="510"></div>
</div>
</div>

</div>
<div class="primary-sidebar">
<div class="box">
<div class="box-title">Деякі дописи</div>
<div class="box-content">
<ul>
<li><a href="/blog/hexabble">Гексабл</a></li>
<li><a href="/blog/country-flags">Прапорці</a></li>
<li><a href="/blog/kalendaryk-pynaryk">Календарик</a></li>
<li><a href="/blog/months">Шпаргалка місяців</a></li>
<li><a target="_blank" href="/simple-pages/unicode-table/1">Таблиця символів</a></li>
<li><a href="/blog/prykoly-skaipu">Приколи скайпу</a></li>
<li><a href="/blog/dovhi-anekdoty">Довгі анекдоти</a></li>
<li><a href="/blog/two-plus-two">2 + 2 = 5</a></li>
<li><a href="/blog/usi-trykutnyky-odynakovi">Однакові △</a></li>
</ul>
</div>
</div>
<div class="box">
<div class="box-title">Сторінки</div>
<div class="box-content">
<ul>
<li><a href="/pages/takaboni/1">Такабоні</a></li>
<li><a href="/pages/archive">Архів</a></li>
</ul>
</div>
</div>
<div class="box">
<div class="box-title">Цікаві сайти</div>
<div class="box-content">
<ul>
<li><a title="Українізація чужизмів" target="_blank" class="external" href="http://slovotvir.org.ua">Словотвір</a></li>
<li><a title="Український цитатник" target="_blank" class="external" href="http://ukrbash.org/">УкрБаш</a></li>
<li><a title="Український торент-трекер" target="_blank" class="external" href="http://hurtom.com/">Гуртом</a></li>
</ul>

</div>
</div>


</div>
</div>
</div>
<div class="footer">
<div class="page-wrap">
<div class="col">
<div class="footer-title">Останні дописи</div>
<ul>
<li><a href="/blog/kalendaryk-pynaryk-na-2022">Календарик-пинарик на 2022</a></li>
<li><a href="/blog/novorichna-yalynka">Новорічна ялинка</a></li>
<li><a href="/blog/utf8-tablycia-ta-inshe">Таблиця UTF8 та цікаві знахідки</a></li>
<li><a href="/blog/vidrodzhennia-blohu">Новорічні резолюції — відродження блогу</a></li>
<li><a href="/blog/site-news-101">Новини сайту 101</a></li>
</ul>
</div>
</div>
</div>

</body>
</html>
