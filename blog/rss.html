<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Робимо RSS стрічку новин</title>
<meta content="Робимо RSS стрічку новин" itemprop="description" property="og:title">
<meta content="як зробити rss стрічку новин на asp.net" itemprop="name" name="description" property="og:description">
<meta content="http://lukom.org/blog/rss" property="og:url">
<meta content="http://lukom.org/system/blog-images/rss-xml-feed-icon.png" property="og:image">
<meta content="article" property="og:type">
<meta content="100001353345404" property="fb:admins">
<meta content="143733555820368" property="fb:app_id">
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="PlcTkV81sO2rvjvGoMooav9b4awMwtJ1ffZHMvTa42UkPz69Toz6TxTrZFgKqS3ofljpT2QijWi9eoy/IKOWdw==" />
<link href="/rss.xml" rel="alternate" title="Найсвіжіші новини на Lukom.Org" type="application/rss+xml">
<link href="/favicon.ico" rel="shortcut icon">
<link href="http://lukom.org/blog/rss" rel="canonical">
<link rel="stylesheet" media="all" href="/assets/application-62b843cdf11b7d1c3ec4770e46cf10db6ab85cce990700bd6f2bdcb79a5821e8.css" />


<script src="/assets/application-d74f2472fca0149ef13a2494ca651a42cabe54050dbec767cf4fca412ec93b3f.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-19834031-1', 'lukom.org');
  ga('send', 'pageview');
</script>

<script async="async" src="https://apis.google.com/js/platform.js">
{lang: 'uk'}
</script>

</head>
<body>
<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=143733555820368";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>
<div class="header-toolbar">
<div class="page-wrap">
<ul>
<li><a href="/">Головна</a></li>
<li><a href="/pages/author">Автор</a></li>
</ul>
</div>
</div>
<div class="header">
<div class="page-wrap">
<div class="logo">
<div class="logo-text">Вперед і вгору!</div>
<div class="logo-subtext">блог Лукома</div>
</div>
<div class="about-author">
<div class="author-speak">
Привіт, мене звати Лев Лукомський
<br/> я займаюсь розробкою веб-сайтів та ігор
<br/> ..і записую в блог все що взбреде в голову :)
<a href="/pages/author">Автор</a>
</div>
<div class="follow-links">
<a class="rss-big-link" target="_blank" href="/rss.xml">RSS</a>
</div>
<div class="contacts-links">
<a title="Джмейл" class="gmail ico" href="mailto:lllukom@gmail.com">Gmail</a>
<a title="Цукердрук" class="facebook ico" target="_blank" href="https://www.facebook.com/llukomsky">Facebook</a>
<a title="Ґуґлоплюсик" class="gplus ico" target="_blank" href="https://plus.google.com/+%D0%9B%D0%B5%D0%B2%D0%9B%D1%83%D0%BA%D0%BE%D0%BC%D1%81%D1%8C%D0%BA%D0%B8%D0%B9">Google Plus</a>
</div>
</div>
</div>
</div>
<div class="main-menu">
<div class="page-wrap">
<ul>
<li><a href="/category/rozrobka">Розробка (22)</a></li>
<li><a href="/category/rizne">Різне (52)</a></li>
<li><a href="/category/tsikavynky">Цікавинки (12)</a></li>
<li><a href="/category/veseloshchi">Веселощі (14)</a></li>
<li>
<a href="/category/novyny-saitu">Новини сайту</a>
</li>
</ul>
</div>
</div>

<div class="torso">
<div class="page-wrap">
<div class="page-content">
<div class="flash-messages">
</div>

<div class="box main-box post rozrobka">
<h1 class="box-title">Робимо RSS стрічку новин</h1>
<div class="box-content">
<div class="post-meta">
<span class="link category-link">
<a href="/category/rozrobka">Розробка</a>
</span>
<span class="link tag-link">Як зробити, Rss, Asp.Net, Xml</span>
<span class="link date-link">2007.10.26</span>
<span class="link edited-link">Відредаговано: 2016.05.15</span>
</div>
<div class="post-content"><div class="box-images"><img alt="" src="/system/blog-images/rss-xml-feed-icon.png" style="height:50px; width:50px" /></div>

<p>Ех, багато розвелось по сайтах цих оранжевих кнопочок :) Зараз це модно, тому треба зробити таку і на своєму сайті, крім того це зовсім не важко. В цій статті я розкажу як зробити RSS стрічку новин на Asp.Net.<br />
Як можна довідатись з <a class="external" href="https://uk.wikipedia.org/wiki/RSS" target="_blank">вікіпедії</a>, <strong>RSS</strong> канал - це просто певної структури <strong>XML</strong>-файл, в якому містяться останні новини сайту. Отже, задача полягає в тому, щоб згенерувати цей <strong>XML</strong>-файл, і поставити на сайті на нього лінк.</p>

<p>&nbsp;</p>

<p>Спочатку глянемо що собою являє цей XML-файл:</p>

<p><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;rss version=&quot;2.0&quot;&gt; &lt;channel&gt; &lt;title&gt;Lukom.Org&lt;/title&gt; &lt;link&gt;http://lukom.org/rss20feed.aspx&lt;/link&gt; &lt;description&gt;Останні новини з блогу на Lukom.Org&lt;/description&gt; &lt;copyright&gt;&copy; 2004, Lukom. All rights reserved.&lt;/copyright&gt; &lt;ttl&gt;5&lt;/ttl&gt; &lt;item&gt; &lt;title&gt;Петиції&lt;/title&gt; &lt;description&gt;Новина 1...&lt;/description&gt; &lt;link&gt;http://lukom.org/blog/petitions&lt;/link&gt; &lt;pubDate&gt;Mon, 22 Oct 2007 13:27:28 GMT&lt;/pubDate&gt; &lt;/item&gt; &lt;item&gt; &lt;title&gt;Хроніки DnD. частина перша&lt;/title&gt; &lt;description&gt;Новина 2...&amp;lt;a href=&amp;quot;http://lukom.org/blog/dnd-begin&amp;quot;&amp;gt;(Читати далі...)&amp;lt;/a&amp;gt;&lt;/description&gt; &lt;link&gt;http://lukom.org/blog/dnd-begin&lt;/link&gt; &lt;pubDate&gt;Sun, 21 Oct 2007 10:34:31 GMT&lt;/pubDate&gt; &lt;/item&gt; &lt;/channel&gt; &lt;/rss&gt; </code></p>

<p>&nbsp;</p>

<p>Вражає, правда? Структура дуже проста. Починається все з обов&#39;язкової <strong>xml</strong>-декларації, потім вкладений елемент <strong>rss</strong>, в якому обов&#39;язковими елементами є <strong>title</strong> і <strong>description</strong>. Також дуже потрібними є елементи <strong>link</strong> i <strong>pubDate</strong>, які містять відповідно лінк на оригінальну новину і час публікації у форматі <strong>GMT</strong>. Елемент <strong>ttl</strong> (time to live) вказує на скільки часу клієнт має закешувати файл.<br />
Всі елементи які дозволяє RSS стандарт можна подивитись тут - <a class="external" href="http://www.rssboard.org/rss-specification" target="_blank">RSS 2.0 Specification</a></p>

<p>Тепер зробимо генерування цього файлу. Своримо нову aspx-сторінку з таким контентом:</p>

<p><code>&lt;%@ Page Language=&quot;C#&quot; CodeFile=&quot;rss20feed.aspx.cs&quot; Inherits=&quot;rss20feed&quot; EnableViewState=&quot;false&quot; %&gt; &lt;%@ OutputCache Duration=&quot;300&quot; VaryByParam=&quot;none&quot; %&gt; </code></p>

<p>Другий рядок вказує Asp.Net`у, що цей файл треба закешувати на 5 хвилин. Можна поставити, звісно, більше число, але не хотілося б щоб був великий проміжок часу між з&#39;являнням новини на сайті і з&#39;являнням у стрічці новин.</p>

<p>На сторінку з кодом впишемо таке:</p>

<p><code>using System; using System.Data.SqlClient; using System.Text; using System.Web.UI; using System.Xml; public partial class rss20feed : Page { protected override void OnLoad(EventArgs e) { base.OnLoad(e); Response.Clear(); Response.ContentType = &quot;text/xml&quot;; XmlTextWriter rss = new XmlTextWriter(Response.OutputStream, Encoding.UTF8); rss.WriteStartDocument(); rss.WriteStartElement(&quot;rss&quot;); rss.WriteAttributeString(&quot;version&quot;, &quot;2.0&quot;); rss.WriteStartElement(&quot;channel&quot;); rss.WriteElementString(&quot;title&quot;, &quot;Lukom.Org&quot;); rss.WriteElementString(&quot;link&quot;, &quot;http://lukom.org/rss20feed.aspx&quot;); rss.WriteElementString(&quot;description&quot;, &quot;Останні новини з блогу на Lukom.Org&quot;); rss.WriteElementString(&quot;copyright&quot;, &quot;&copy; 2004, Lukom. All rights reserved.&quot;); rss.WriteElementString(&quot;ttl&quot;, &quot;5&quot;); SqlConnection conn = new SqlConnection(Global.ConnectionString); conn.Open(); try { string sql = &quot;SELECT TOP 10 Title, Summary, ArticleUrlName, PostTime FROM Articles ORDER BY PostTime DESC&quot;; SqlCommand cmd = new SqlCommand(sql, conn); SqlDataReader reader = cmd.ExecuteReader(); while (reader.Read()) { rss.WriteStartElement(&quot;item&quot;); rss.WriteElementString(&quot;title&quot;, reader.GetString(0)); rss.WriteElementString(&quot;description&quot;, reader.GetString(1)); rss.WriteElementString(&quot;link&quot;, &quot;http://lukom.org/blog/&quot; + reader.GetInt32(2)); rss.WriteElementString(&quot;pubDate&quot;, reader.GetDateTime(3).ToString(&quot;R&quot;)); rss.WriteEndElement(); } } finally { conn.Close(); } rss.WriteEndElement(); rss.WriteEndElement(); rss.WriteEndDocument(); rss.Flush(); rss.Close(); Response.End(); } } </code></p>

<p>Тут створюється об&#39;єкт <strong>XmlTextWriter</strong>, який займається генеруванням <strong>XML</strong>. Останні новини дістаємо з бази даних. Звісно, в мене на сайті трохи складніший код, але загалом суть та сама. Гарною ідеєю є покласти цей код в <strong>HttpHandler</strong>, а не в <strong>OnLoad</strong>.</p>

<p>І так, та-дам, готово! Тепер коли код написано, залишилось кинути на строрінку лінки, щоб про RSS взнав відвідувач і браузер.<br />
Для того щоб знав відвідувач, десь на видному місці розміщуємо таку кнопочку <img alt="Останні новини з блогу на Lukom.Org у форматі RSS 2.0" src="/system/blog-images/banners/rss_80x15.gif" style="height:15px; width:80px" title="Останні новини з блогу на Lukom.Org у форматі RSS 2.0" /> з лінком на наш RSS канал новин. Користувач замітить цей значок і скопіює лінк у свій агрегатор новин.<br />
Для того, щоб про RSS знав браузер, треба в <strong>head</strong>`і документа розмістити таке:</p>

<p><code>&lt;link rel=&quot;alternate&quot; type=&quot;application/rss+xml&quot; title=&quot;Останні новини з блогу на Lukom.Org&quot; href=&quot;rss20feed.aspx&quot; /&gt; </code></p>

<p>В цьому випадку більшість браузерів в правій стороні адресної стрічки намалює RSS-іконку, на якій можна буде клацнути і щось там зробити.</p>

<p>Тепер, коли на сайті є RSS стрічка новин, відвідувачам відкриваються нові корисні можливості:</p>

<ol>
	<li>не треба завантажувати всю сторінку з новинами</li>
	<li>можна легко слідкувати за оновленнями</li>
</ol>

<p>Ще на багатьох сайтах є стрічка новин у форматі <strong><a class="external" href="http://en.wikipedia.org/wiki/Atom_%28standard%29" target="_blank">ATOM</a></strong>, яка виникла внаслідок незадоволення форматом <strong>RSS</strong>, тому він є кращим, але важчим.</p>
</div>
<div class="social-buttons">
<div class="fb-like" data-layout="button_count" data-send="false" data-width="120"></div>
<a class="twitter-share-button" data-hashtags="lukomorg" data-lang="uk" data-text="Робимо RSS стрічку новин" data-url="http://lukom.org/blog/rss" href="https://twitter.com/share">Tweet</a>
<div class="g-plusone" data-annotation="bubble" data-size="medium" data-width="120"></div>
<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';
  if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';
  fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  
  window.___gcfg = {lang: 'uk'};
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
</div>

<div id="related_posts">
<div class="h2">Читайте також</div>
<ul>
<li><a href="/blog/waterbomb">Робимо водяні бомбочки</a></li>
</ul>
</div>
<div id="comments">
<div class="comments" id="comments_entries">
<div class="h2" style="display:none">Коментарі (<span>0</span>)</div>
</div>
</div>

<div class="fb-comments" data-href="http://lukom.org/blog/rss" data-num-posts="5" data-width="510"></div>
</div>
</div>

</div>
<div class="primary-sidebar">
<div class="box">
<div class="box-title">Деякі дописи</div>
<div class="box-content">
<ul>
<li><a href="/blog/hexabble">Гексабл</a></li>
<li><a href="/blog/country-flags">Прапорці</a></li>
<li><a href="/blog/kalendaryk-pynaryk">Календарик</a></li>
<li><a href="/blog/months">Шпаргалка місяців</a></li>
<li><a target="_blank" href="simple-pages/utf8-table/1">Таблиця utf-8</a></li>
<li><a href="/blog/prykoly-skaipu">Приколи скайпу</a></li>
<li><a href="/blog/dovhi-anekdoty">Довгі анекдоти</a></li>
<li><a href="/blog/two-plus-two">2 + 2 = 5</a></li>
<li><a href="/blog/usi-trykutnyky-odynakovi">Однакові △</a></li>
</ul>
</div>
</div>
<div class="box">
<div class="box-title">Сторінки</div>
<div class="box-content">
<ul>
<li><a href="/pages/takaboni/1">Такабоні</a></li>
<li><a href="/pages/archive">Архів</a></li>
</ul>
</div>
</div>
<div class="box">
<div class="box-title">Цікаві сайти</div>
<div class="box-content">
<ul>
<li><a title="Українізація чужизмів" target="_blank" class="external" href="http://slovotvir.org.ua">Словотвір</a></li>
<li><a title="Український цитатник" target="_blank" class="external" href="http://ukrbash.org/">УкрБаш</a></li>
<li><a title="Український торент-трекер" target="_blank" class="external" href="http://hurtom.com/">Гуртом</a></li>
</ul>

</div>
</div>
<div class="box counters">
<div class="box-title">Подобається? Плюсуйте!</div>
<div class="box-content">
<div class="g-page" data-href="https://plus.google.com/106462298861442752735" data-rel="publisher" data-showcoverphoto="false" data-showtagline="false" data-width="215"></div>
</div>
</div>


</div>
</div>
</div>
<div class="footer">
<div class="page-wrap">
<div class="col">
<div class="footer-title">Останні дописи</div>
<ul>
<li><a href="/blog/site-news-100">Новини сайту 100</a></li>
<li><a href="/blog/site-news-100">Новини сайту 100</a></li>
<li><a href="/blog/usi-vybory-nechesni">Усі вибори нечесні</a></li>
<li><a href="/blog/suchasni-puzomirky">Сучасні пузомірки</a></li>
<li><a href="/blog/spdy-na-saiti">Поставив SPDY на сайт</a></li>
</ul>
</div>
</div>
</div>

</body>
</html>
